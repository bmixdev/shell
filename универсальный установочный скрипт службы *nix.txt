ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¾Ñ‡Ð½Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:

âœ” ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÑ‚ Ð²ÐµÑÑŒ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð° Ð½Ðµ Ð¾Ð´Ð¸Ð½ Ñ„Ð°Ð¹Ð»)
âœ” ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ systemd-ÑÐ»ÑƒÐ¶Ð±Ñƒ
âœ” Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð°
âœ” Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÑÐ»ÑƒÐ¶Ð±Ñƒ

ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ñ€ÑÐ´Ð¾Ð¼ Ñ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð¾Ð¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:

project/
    myapp.py
    utils/
    config/
install_service.sh

âœ… install_service.sh â€” Ð²ÐµÑ€ÑÐ¸Ñ Ñ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð°
#!/bin/bash

# ======================================
# ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
# ======================================
SERVICE_NAME="myapp"
SOURCE_DIR="project"          # ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼ (Ð»ÐµÐ¶Ð¸Ñ‚ Ñ€ÑÐ´Ð¾Ð¼ ÑÐ¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð¼)
INSTALL_DIR="/opt/myapp"      # ÐºÑƒÐ´Ð° ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
SERVICE_USER="myuser"         # Ð¿Ð¾Ð´ ÐºÐµÐ¼ Ð±ÑƒÐ´ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ ÑÐ»ÑƒÐ¶Ð±Ð°
ENTRY_POINT="myapp.py"        # Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» Python Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
# ======================================

echo "=== Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python ÑÐ»ÑƒÐ¶Ð±Ñ‹: $SERVICE_NAME ==="

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° root
if [[ $EUID -ne 0 ]]; then
   echo "Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· sudo Ð¸Ð»Ð¸ Ð¿Ð¾Ð´ root"
   exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
if [[ ! -d "$SOURCE_DIR" ]]; then
    echo "ÐžÑˆÐ¸Ð±ÐºÐ°: ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ '$SOURCE_DIR' Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ñ€ÑÐ´Ð¾Ð¼ ÑÐ¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð¼"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° entrypoint
if [[ ! -f "$SOURCE_DIR/$ENTRY_POINT" ]]; then
    echo "ÐžÑˆÐ¸Ð±ÐºÐ°: Ñ„Ð°Ð¹Ð» $ENTRY_POINT Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ðµ $SOURCE_DIR"
    exit 1
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
echo "[*] Ð¡Ð¾Ð·Ð´Ð°ÑŽ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ $INSTALL_DIR"
mkdir -p "$INSTALL_DIR"

# ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð²ÐµÑÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚
echo "[*] ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÑŽ Ð²ÐµÑÑŒ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:"
echo "    $SOURCE_DIR â†’ $INSTALL_DIR"
rsync -av --delete "$SOURCE_DIR/" "$INSTALL_DIR/"

# ÐŸÑ€Ð°Ð²Ð°
echo "[*] Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ Ð¿Ñ€Ð°Ð²Ð°"
chown -R $SERVICE_USER:$SERVICE_USER "$INSTALL_DIR"
chmod -R 755 "$INSTALL_DIR"
chmod +x "$INSTALL_DIR/$ENTRY_POINT"

# Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ systemd unit
SERVICE_PATH="/etc/systemd/system/${SERVICE_NAME}.service"
echo "[*] Ð¡Ð¾Ð·Ð´Ð°ÑŽ systemd ÑÐ»ÑƒÐ¶Ð±Ñƒ: $SERVICE_PATH"

cat > "$SERVICE_PATH" <<EOF
[Unit]
Description=Python Service $SERVICE_NAME
After=network.target

[Service]
Type=simple
User=$SERVICE_USER
Group=$SERVICE_USER
WorkingDirectory=$INSTALL_DIR
ExecStart=/usr/bin/python3 $INSTALL_DIR/$ENTRY_POINT

Restart=always
RestartSec=5

StandardOutput=append:/var/log/${SERVICE_NAME}.log
StandardError=append:/var/log/${SERVICE_NAME}_err.log

[Install]
WantedBy=multi-user.target
EOF

# ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ systemd
echo "[*] systemctl daemon-reload"
systemctl daemon-reload

# Ð¡Ñ‚Ð°Ñ€Ñ‚ÑƒÐµÐ¼
echo "[*] Ð—Ð°Ð¿ÑƒÑÐº ÑÐ»ÑƒÐ¶Ð±Ñ‹"
systemctl start "$SERVICE_NAME"

# ÐÐ²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº
echo "[*] Ð’ÐºÐ»ÑŽÑ‡Ð°ÑŽ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº"
systemctl enable "$SERVICE_NAME"

echo "=== Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ ==="
systemctl status "$SERVICE_NAME" --no-pager

ðŸ“Œ ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ
1. Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²:
install_service.sh
project/
    myapp.py
    ...

2. Ð”Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð°:
chmod +x install_service.sh

3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:
sudo ./install_service.sh
